function transformSearchResults(a,b){for(var c=[],d=0;d<a.length;d++){var e,f,g=a[d].content_type_enum;switch(g){case"ENTERTAINMENT_VIDEO_MOVIE":a[d]&&a[d].searchResultRelcy&&a[d].searchResultRelcy.results&&a[d].searchResultRelcy.results.length&&(e=a[d].searchResultRelcy.results,f="Movies");break;case"ENTERTAINMENT_VIDEO_TVSHOW":a[d]&&a[d].searchResultRelcy&&a[d].searchResultRelcy.results&&a[d].searchResultRelcy.results.length&&(e=a[d].searchResultRelcy.results,f="TV Shows");break;case"WEB_VIDEOS":a[d]&&a[d].videoSearchResult&&a[d].videoSearchResult.videoSearchResults&&a[d].videoSearchResult.videoSearchResults.length&&(e=a[d].videoSearchResult.videoSearchResults,f="Videos");break;case"WEB_IMAGES":a[d]&&a[d].imageSearchResult&&a[d].imageSearchResult.imageSearchResults&&a[d].imageSearchResult.imageSearchResults.length&&(e=a[d].imageSearchResult.imageSearchResults,f="Images");break;case"WEB":a[d]&&a[d].webSearchResult&&a[d].webSearchResult.searchResults&&a[d].webSearchResult.searchResults.length&&(e=a[d].webSearchResult.searchResults,f="WEB");break;case"WEB_NEWS":a[d]&&a[d].newsSearchResult&&a[d].newsSearchResult.newsSearchResults&&a[d].newsSearchResult.newsSearchResults.length&&(e=a[d].newsSearchResult.newsSearchResults,f="News");break;case"APP":a[d]&&a[d].searchResultRelcy&&a[d].searchResultRelcy.results&&a[d].searchResultRelcy.results.length&&(e=a[d].searchResultRelcy.results,f="APP");break;case"RELATED_SEARCHES":a[d]&&a[d].relatedSearchesResult&&a[d].relatedSearchesResult.relatedSearchResults&&a[d].relatedSearchesResult.relatedSearchResults.length&&(b.relatedSearches=a[d].relatedSearchesResult.relatedSearchResults),e=void 0}e&&c.push({key:g,values:e,keyTitle:f,maxIndex:2,incrementBy:2})}return c}angular.module("relcyApp",["ui.router","ui.bootstrap","angucomplete-alt"]),angular.module("relcyApp").config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","$locationProvider",function(a,b,c,d,d){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/home.html",controller:"SearchController"}).state("details",{url:"/details",templateUrl:"views/detail.html",controller:"SearchController"})}]),angular.module("relcyApp").controller("SearchController",["$scope","$http","$rootScope","$location","SearchService","$filter","anchorSmoothScroll",function(a,b,c,d,e,f,g){function h(a){return a?new Array(Math.floor(a)):[]}function i(a){return a%1>0}function j(){for(var b=0;b<a.types.length;b++)if(a.hasResults(a.types[b].content_type_enum,b)){a.showResult(a.types[b].content_type_enum,b);break}}a.selectedTypeIndex=0,a.selectedCategory,a.showDetailPage=!1,a.selected=0,a.showingResult=!1,a.hideMainSearch=!1,a.relatedSearches,a.query,a.showResult=function(b,c){a.selectedTypeIndex=b,a.resultByType=a.types[c]},a.hasResults=function(b,c){switch(b){case"ENTERTAINMENT_VIDEO_MOVIE":return a.types[c]&&a.types[c].searchResultRelcy&&a.types[c].searchResultRelcy.results&&a.types[c].searchResultRelcy.results.length;case"WEB_VIDEOS":return a.types[c]&&a.types[c].videoSearchResult&&a.types[c].videoSearchResult.videoSearchResults&&a.types[c].videoSearchResult.videoSearchResults.length;case"WEB":return a.types[c]&&a.types[c].webSearchResult&&a.types[c].webSearchResult.searchResults&&a.types[c].webSearchResult.searchResults.length;case"APP":return a.types[c]&&a.types[c].searchResultRelcy&&a.types[c].searchResultRelcy.results&&a.types[c].searchResultRelcy.results.length;case"RELATED_SEARCHES":return a.types[c]&&a.types[c].relatedSearchesResult&&a.types[c].relatedSearchesResult.relatedSearchResults&&a.types[c].relatedSearchesResult.relatedSearchResults.length;default:return!1}},a.addScores=function(a){return a?(angular.forEach(a.auto_complete_response.auto_complete_item,function(a){a.scoreArray=h(a.score),a.showHalfRating=i(a.score)}),a.auto_complete_response):void 0},a.onInputChange=function(b){a.query=b},a.searchForSelection=function(b){b&&b.title&&a.search(b.title)},a.search=function(b){b&&(console.log(b),e.getSearchDetails(b).then(function(b){return a.showDetailPage=!1,a.showingResult=!0,a.result=b.search_response,a.result.verticalResult?(a.searchResults=transformSearchResults(a.result.verticalResult,a),a.selectedCategory=a.searchResults[0].key,a.types=a.result.verticalResult,void j()):void(a.showingResult=!1)},function(b){a.showingResult=!1,a.gridMessage="Error while loading data"}))},a.clearSearchInput=function(b){a.hideMainSearch=!1,a.showDetailPage=!1,a.$broadcast("angucomplete-alt:clearInput","members"),a.showingResult=!1,a.$broadcast("angucomplete-alt:clearInput",b)},a.scrollTo=function(b){a.selectedCategory=b,d.hash(b),g.scrollTo(b)},a.onAutoCompleteSelect=function(b){b&&(b.originalObject.lookIds&&b.originalObject.lookIds[0]?a.showDetails(b):a.searchForSelection(b))},a.showDetails=function(b){a.showingResult=!1,a.hideMainSearch=!0;var c;return b.relcy_id&&b.relcy_id.entity_id?c=b.relcy_id.entity_id:b.originalObject.lookIds&&b.originalObject.lookIds[0]&&(c=b.originalObject.lookIds[0]),c?(a.showDetailPage=!0,void e.getEntityDetails(c).then(function(c){e.selectedItem=b,a.itemDetails=e.transformDetails(c)},function(a){console.log("Error while fetching details!!!")})):void console.log("Relcy id not found!")}}]),angular.module("relcyApp").service("SearchService",["$timeout","$q","$http",function(a,b,c){this.searchResult=[],this.getSearchDetails=function(a){var d="37.762759",e="-122.408934",f=b.defer();return c.get("http://staging-w.relcy.com/search?lat="+d+"&lng="+e+"&sessionId=b9a30926-e912-11e4-b02c-1681e6b88ec1&query="+a).success(function(a){f.resolve(a)}).error(function(a,b){f.reject(a)}),f.promise},this.getEntityDetails=function(a){var d="37.762759",e="-122.408934",f=b.defer();return c.get("http://staging-w.relcy.com/detail?lat="+d+"&lng="+e+"&sessionId=b9a30926-e912-11e4-b02c-1681e6b88ec1&&id="+a).success(function(a){f.resolve(a)}).error(function(a,b){f.reject(a)}),f.promise},this.search=function(a){var b="b9a30926-e912-11e4-b02c-1681e6b88ec1",d="37.762759",e="-122.408934",a=a,f=c({method:"get",url:"/test/arc-response-2015_Apr_24_12-21-31.json?sessionId="+b+"&lat="+d+"&lng="+e+"&query="+a});return f.then(this.handleSuccess,this.handleError)},this.transformDetails=function(a){var b={};if(a=a.detail_response){var c=a.search_result_collection;if(c){try{b.webResults=c.webSearchResult.searchResults,b.webResults.maxIndex=3}catch(d){console.log("no web results found")}try{b.imageResults=c.imageSearchResult.imageSearchResults,b.imageResults.maxIndex=3}catch(d){console.log("no image results found")}try{b.videoResults=c.videoSearchResult.videoSearchResults,b.videoResults.maxIndex=5}catch(d){console.log("no video results found")}}try{b.duration=a.results[0].entity_data.entertainment_data.movie_data.length}catch(d){console.log("duration unknown")}try{b.releaseYear=a.results[0].entity_data.entertainment_data.common_data.release_year}catch(d){console.log("release year unknown")}}return b},this.handleError=function(a){return console.log(a),404==a.status&&"Result not available."==a.data?a:(console.log(a),b.reject(angular.isObject(a.data)&&a.data.message?a:a))},this.handleSuccess=function(a){var b=a.data;return b}}]),angular.module("relcyApp").service("anchorSmoothScroll",function(){this.scrollTo=function(a){function b(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function c(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!=document.body;)d=d.offsetParent,c+=d.offsetTop;return c}var d=b(),e=c(a),f=e>d?e-d:d-e;if(100>f)return void scrollTo(0,e);var g=Math.round(f/100);g>=20&&(g=20),g=15;var h=Math.round(f/25),i=e>d?d+h:d-h,j=0;if(e>d)for(var k=d;e>k;k+=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i+=h,i>e&&(i=e),j++;else for(var k=d;k>e;k-=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i-=h,e>i&&(i=e),j++}});