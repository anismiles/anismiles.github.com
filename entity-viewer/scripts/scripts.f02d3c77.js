"use strict";function State(a,b){this.http=a,this.cookies=b}function SearchCtrl(a,b,c,d,e,f,g){a.searchResults=[],a.appResults=[],a.webResults=[],a.loading=!0;var h={};h.lookId="look:9150318478150475564",h.api_key="5E23B46EE823001F9AE0DF0665B56B617122FCC3",null!=d.search().lat&&null!=d.search().lng&&(h.lat=d.search().lat,h.lng=d.search().lng),e.getSearchDetails(h).then(function(b){a.parseData(b)},function(a){}),a.parseData=function(b){var c=b.apiDetailResponse.detail_response.verticalResult,d={};if(null!=c&&c.length>0){for(var e=0;e<c.length;e++)if("searchResultRelcy"in c[e]){var f=c[e].searchResultRelcy.results[0],g=f.entity_data.common_data,h=f.content_type_enum;if(g.name.length>26?d.title=g.name.substring(0,26)+"...":d.title=g.name,d.title=g.name,0===h.lastIndexOf("LOCAL",0)){var i=f.entity_data.local_data;d.subtitle=i.location_info&&i.location_info.address?i.location_info.address.display_address:"";var j=i.category?i.category:"",k=i.price_range?Array(i.price_range.rating+1).join("$"):null;d.subtitle2=j?k?[j,k].join(" • "):j.join("/"):k}if(0===h.lastIndexOf("ENTERTAINMENT",0)){var l=f.entity_data.entertainment_data,m=l.common_data.parental_rating,n=l.common_data.release_year,o=l.common_data.genre?l.common_data.genre.join("/"):"";d.subtitle=m?[m,n].join(" • "):n,d.subtitle2=o}if(0===h.lastIndexOf("PERSON",0)){var p=f.entity_data.people_data;d.subtitle=p.work_title?p.work_title[0]:""}var q="./icons/movie_poster.png";if(f.image_info&&(q=f.image_info[0].mediaURL),d.img=q,"display_rating"in g&&g.display_rating.length>0){var r=g.display_rating[0];d.origRating=r.rating+"/"+r.max_rating;var s=parseFloat(5*r.rating/r.max_rating).toFixed(1),t=parseFloat(Math.round(2*s)/2).toFixed(1);d.ratingUrl="stars/"+t+".png",d.ratingSource=r.source}if(d.description=g.summary.value,d.socialResults=f.social_result,null!=l){var u=l.movie_data&&l.movie_data.theatre_showtime?l.movie_data.theatre_showtime.showtimes:null;if(null!=u){d.showtimes=[];for(var v=0;v<u.length;v++){for(var w=u[v].playing_entity,x=u[v].shows.days[0].hours,y=u[v].playing_entity.location.address,z=u[v].playing_entity.location.display_distance,A=[y.street_address,y.city,y.state,y.postal_code],B=[],C=0;C<x.length;C++)B.push({time:x[C].open_display_string,url:x[C].link_info.link_id[0]});d.showtimes.push({value:w.title,distance:z,times:B,address:A.join(", ")})}}}for(var D=f.link,E={},F=null,G=0;G<D.length;G++)if("APP_LINK"===D[G].link_type){var H=D[G],I={};if(""==H.app_result.app.app_id)continue;if("Phone"==H.app_result.app.app_id){if(F)continue;F=!0}I.url=H.link_id,H.app_result.app.app_id.length>25?I.app_id=H.app_result.app.app_id.substring(0,23)+"..":I.app_id=H.app_result.app.app_id,I.icon="./icons/"+H.app_result.app.app_id+".png",I.action=H.app_result.result_data.action,null==E[I.action]&&(E[I.action]=[]),E[I.action].push(I)}d.app_result=E}else"WEB"===c[e].content_type_enum?d.webSearchResult=c[e].webSearchResult.searchResults:"WEB_VIDEOS"===c[e].content_type_enum?d.videoSearchResults=c[e].videoSearchResult.videoSearchResults:"WEB_IMAGES"===c[e].content_type_enum?d.imageSearchResults=c[e].imageSearchResult.imageSearchResults:"WEB_NEWS"===c[e].content_type_enum?d.newsSearchResults=c[e].newsSearchResult.newsSearchResults:"RELATED_SEARCHES"===c[e].content_type_enum&&(d.relatedSearchResults=c[e].relatedSearchesResult.relatedSearchResults);a.searchResults.push(d),$("#desktop-bg").css({background:"url('"+q+"')","background-size":"cover"})}},a.toCamelCase=function(a){return(a||"").toLowerCase().replace(/(\b|-)\w/g,function(a){return a.toUpperCase().replace(/-/,"")})},a.range=function(a,b,c){c=c||1;for(var d=[],e=a;b>=e;e+=c)d.push(e);return d}}String.prototype.replaceAt||(String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var rrModule=angular.module("myApp",["ngRoute","ngCookies","myApp.filters","myApp.services","myApp.directives","myApp.controllers","ui.bootstrap"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/search.html",controller:"SearchCtrl"})}]);rrModule.directive("selectOnClick",function(){return function(a,b,c){b.bind("click",function(){this.select()})}}),rrModule.directive("focusMe",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusMe);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})}),d.bind("blur",function(){try{c.$apply(f.assign(c,!1))}catch(a){}})}}}]),rrModule.factory("state",["$http","$cookies",function(a,b){var c=new State(a,b);return c}]),angular.module("myApp.services",[]).service("SearchService",["$timeout","$q","$http",function(a,b,c){var d=this;this.url="https://staging-w.relcy.com/v0/entity",this.getSearchDetails=function(a){var e=b.defer();return c({url:d.url,method:"GET",params:a}).success(function(a){e.resolve(a)}).error(function(a,b){e.reject(a)}),e.promise}}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("myApp.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},angular.module("myApp.controllers",[]).controller("SearchCtrl",["$scope","$window","$http","$location","SearchService","$rootScope","$route",SearchCtrl]);