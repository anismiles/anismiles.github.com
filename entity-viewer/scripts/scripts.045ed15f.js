"use strict";function State(a,b){this.http=a,this.cookies=b}function SearchCtrl(a,b,c,d,e,f){a.searchResults=[],a.appResults=[],a.webResults=[],f.metadata={},a.loading=!0;var g={};g.lookId=d.search().lookId,g.api_key="5E23B46EE823001F9AE0DF0665B56B617122FCC3",null!=d.search().lat&&null!=d.search().lng&&(g.lat=d.search().lat,g.lng=d.search().lng),e.getSearchDetails(g).then(function(b){a.parseData(b)},function(a){}),a.parseData=function(b){var c=b.apiDetailResponse.detail_response.verticalResult,d={};if(null!=c&&c.length>0){for(var e=0;e<c.length;e++)if("searchResultRelcy"in c[e]){var g=c[e].searchResultRelcy.results[0],h=g.entity_data.common_data,i=g.content_type_enum;if(h.name.length>26?d.title=h.name.substring(0,26)+"...":d.title=h.name,d.title=h.name,f.metadata.title=h.name,f.metadata.description=h.name,f.metadata.image="http://relc.tmsimg.com/NowShowing/139827/139827_bs.jpg",f.metadata.url="http://animesh.org/entity-viewer/",0===i.lastIndexOf("LOCAL",0)){var j=g.entity_data.local_data;d.subtitle=j.location_info&&j.location_info.address?j.location_info.address.display_address:"";var k=j.category?j.category:"",l=j.price_range?Array(j.price_range.rating+1).join("$"):null;d.subtitle2=k?l?[k,l].join(" • "):k.join("/"):l}if(0===i.lastIndexOf("ENTERTAINMENT",0)){var m=g.entity_data.entertainment_data,n=m.common_data.parental_rating,o=m.common_data.release_year,p=m.common_data.genre?m.common_data.genre.join("/"):"";d.subtitle=n?[n,o].join(" • "):o,d.subtitle2=p}if(0===i.lastIndexOf("PERSON",0)){var q=g.entity_data.people_data;d.subtitle=q.work_title?q.work_title[0]:""}var r="./icons/movie_poster.png";if(g.image_info&&(r=g.image_info[0].mediaURL),d.img=r,"display_rating"in h&&h.display_rating.length>0){var s=h.display_rating[0];d.origRating=s.rating+"/"+s.max_rating;var t=parseFloat(5*s.rating/s.max_rating).toFixed(1),u=parseFloat(Math.round(2*t)/2).toFixed(1);d.ratingUrl="stars/"+u+".png",d.ratingSource=s.source}if(d.description=h.summary.value,d.socialResults=g.social_result,null!=m){var v=m.movie_data&&m.movie_data.theatre_showtime?m.movie_data.theatre_showtime.showtimes:null;if(null!=v){d.showtimes=[];for(var w=0;w<v.length;w++){for(var x=v[w].playing_entity,y=v[w].shows.days[0].hours,z=v[w].playing_entity.location.address,A=v[w].playing_entity.location.display_distance,B=[z.street_address,z.city,z.state,z.postal_code],C=[],D=0;D<y.length;D++)C.push({time:y[D].open_display_string,url:y[D].link_info.link_id[0]});d.showtimes.push({value:x.title,distance:A,times:C,address:B.join(", ")})}}}for(var E=g.link,F={},G=null,H=0;H<E.length;H++)if("APP_LINK"===E[H].link_type){var I=E[H],J={};if(""==I.app_result.app.app_id)continue;if("Phone"==I.app_result.app.app_id){if(G)continue;G=!0}J.url=I.link_id,I.app_result.app.app_id.length>25?J.app_id=I.app_result.app.app_id.substring(0,23)+"..":J.app_id=I.app_result.app.app_id,J.icon="./icons/"+I.app_result.app.app_id+".png",J.action=I.app_result.result_data.action,null==F[J.action]&&(F[J.action]=[]),F[J.action].push(J)}d.app_result=F}else"WEB"===c[e].content_type_enum?d.webSearchResult=c[e].webSearchResult.searchResults:"WEB_VIDEOS"===c[e].content_type_enum?d.videoSearchResults=c[e].videoSearchResult.videoSearchResults:"WEB_IMAGES"===c[e].content_type_enum?d.imageSearchResults=c[e].imageSearchResult.imageSearchResults:"WEB_NEWS"===c[e].content_type_enum?d.newsSearchResults=c[e].newsSearchResult.newsSearchResults:"RELATED_SEARCHES"===c[e].content_type_enum&&(d.relatedSearchResults=c[e].relatedSearchesResult.relatedSearchResults);a.searchResults.push(d),$("#desktop-bg").css({background:"url('"+r+"')","background-size":"cover"})}},a.toCamelCase=function(a){return(a||"").toLowerCase().replace(/(\b|-)\w/g,function(a){return a.toUpperCase().replace(/-/,"")})},a.range=function(a,b,c){c=c||1;for(var d=[],e=a;b>=e;e+=c)d.push(e);return d}}String.prototype.replaceAt||(String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var rrModule=angular.module("myApp",["ngRoute","ngCookies","myApp.filters","myApp.services","myApp.directives","myApp.controllers","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/search.html",controller:"SearchCtrl"})}]);rrModule.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),rrModule.directive("selectOnClick",function(){return function(a,b,c){b.bind("click",function(){this.select()})}}),rrModule.directive("focusMe",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusMe);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})}),d.bind("blur",function(){try{c.$apply(f.assign(c,!1))}catch(a){}})}}}]),rrModule.factory("state",["$http","$cookies",function(a,b){var c=new State(a,b);return c}]),angular.module("myApp.services",[]).service("SearchService",["$timeout","$q","$http",function(a,b,c){var d=this;this.url="https://staging-w.relcy.com/v0/entity",this.getSearchDetails=function(a){var e=b.defer();return c({url:d.url,method:"GET",params:a}).success(function(a){e.resolve(a)}).error(function(a,b){e.reject(a)}),e.promise}}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("myApp.directives",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},angular.module("myApp.controllers",[]).controller("SearchCtrl",["$scope","$window","$http","$location","SearchService","$rootScope",SearchCtrl]);